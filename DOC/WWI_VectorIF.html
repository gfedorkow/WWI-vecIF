<!-- Generated by nim2html version 0.1a -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<title>Whirlwind I Hardware Vector Interface</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="author" content="Rainer Glaschick, Paderborn">
</head><body>
<h1 align=center>Whirlwind I Hardware Vector Interface</h1>
<p align=center>Rainer Glaschick, Paderborn<br>
2023-05-13 2023-08-24</p>
<h1>Revision target</h1>
<p>For the transition to the revised Interface that will be version 1.0,
the planned changes are described below. </p>
<p>Using a display bus and additional drop boards better models the 
original situation, even if there are currently only two displays useable.</p>
<h2>Output</h2>
<p>Instead of two outputs for X/Y/Z and two connectors for Lightguns,
a display bus is used:</p>
<ul>
<li>two output lines for X and Y</li>
<li>two output lines for Z1 and Z2</li>
<li>two input lines for Lightguns</li>
<li>+5V and ground.</li>
<li>two input user switch lines (open collector).</li>
</ul>
<p>Standard 14-pin ribbon connectors are used for the bus, 
with two more ground lines and two unused ones.</p>
<p>For each display, a detached drop board is used, which has two bus connectors:
The output of the interface board is connected via a cable to a first drop
board, from there to a second, and so forth. </p>
<p>X and Y output is &plusmn;3V, with a source impedance of 50Ω.
In case long coaxial cables are used, the bus should be terminated,
reducing the level for all drop boards to &plusmn;1.536V.</p>
<p>The Z1 and Z2 outputs are active low standard 5V CMOS (TTL) outputs 
for intensification. 
Many Oszilloscopes use a high TTL signal to blank the trace, 
thus no inversion is needed. </p>
<h2>Drop board</h2>
<p>A drop board has:</p>
<ul>
<li>two potentioemeters (10 kΩ) for the X and Y outputs </li>
<li>two (manual) switches to select Z1 or Z2.</li>
<li>two (manual) switches to connect the light pen signal
to one of the light pen lines.</li>
</ul>
<p>In order to logically OR Z1 and Z2, two schottky diodes driving a 6.8kΩ
resistor may be sufficient, but this may shorten the length of a vector
slightly. 
(The time constant for 100pF load is 0.68&micro;s, which is less than 2%
of the 50&micro;s strobe signal).
Usage of a logic IC is recommended, so that the polarity can be
changed locally.</p>
<p>While two lightguns driving the same line might work and 
will not damage the system, it is discouraged and undefined.</p>
<p>For the two switch lines, two buttons or switches (or both) are
provided connecting to ground. Pin connectors are supplied in parallel, if the
switch is to be placed distancely.  </p>
<p>A special drop board may contain a voltage booster providing 30V from the 5V
supply to have a larger voltage swing at the Z connctor to the display,
in particular for older oszilloscopes.</p>
<h2>Reference voltage</h2>
<p>A reference of 1.024V is required for the integrators to define
the zero speed for displaying points.</p>
<p>The output amplifiers are designed for a 3.3V reference to 
change the internal 1.024&plusmn;1.024V to symmetrical &plusmn;3.076V. </p>
<p>The board may either use a LP2950-3.3 linear regulator from 5V,
or use the 3.3V from the Raspi board directly.</p>
<p>For the integrator's 1.024V, either a trim pot of 10k&Omeaga; plus 
a 22kΩ fixed resistor or a 27kΩ and shorted trimmer may be used.</p>
<p>The output's zero voltage and amplitude is normally not very critical.
A voltage divider with 12kΩ and 10kΩ is used giving fairly good results.
Place for two larger resistors, e.g. 100kΩ and 150kΩ, is provided for 
better results, depending on the accuracy of the 3.3V reference.</p>
<h2>5V protection</h2>
<p>A 0.5A fuse is inserted just before the connector to the Raspi.
Normally more current can be drawn, only limited by the power supply
(minus the current drawn be the Raspi and connected USB perpherals)
and the copper tracks on the Raspi.  
So the drop boards should not used more then 0.4A together,
i.e. 0.2A or 1W each for two.</p>
<h2>Switches</h2>
<p>The standard 4066 CMOS switches actually work fine; the vertical detours
seen on the TEK 611 have not manifested on the oscilloscopes used so far. 
And because it is only on the horizontal signal, it might be 
a hardware problem of the TEK 611,
Although the datasheet for the 4066 gives gives 50mV crosstalk from the 
control signal to the data path, it is in the integration path and thus
will not propagate to the output. 
Although Analog Devices produces a better chip (ADG431), a change 
seems currently not justified, as the 4066 is far better available.</p>
<h2>Intensivation strobe length</h2>
<p>A trim potentiometer will allow to precisely set the strobe length of 
a vector draw. 
Note that the starting (negative) slope of the intensivation signal
must not be delayed, at this would compromise the starting point of the vector.</p>
<h2>Ribbon input connector</h2>
<p>Changed from 26 to 40 pins.</p>
<p>This allows to use additional pins connected to the bus.
In order to protect the Raspi, the pins are open collector
with 47kΩ pullups and 3.3V protection zener diodes (1N4728a or BZX84-3V3)
in a T-configuration of two 470Ω resistors limiting the current
into a low level output to 7mA, preventing severe damage in many cases. </p>
<h1>Introduction</h1>
<p>To connect a Whirlwind I (WWI) machine (emulated or simulated) to a physical CRT
not in raster, but in X-Y-Z-mode,
a hardware interface supports drawing of vectors.
Single points are drawn as zero-length vectors.</p>
<p>The board has a dual 12-Bit D/A converter (MCP 4822) controlled by SPI,
and two digital inputs to set the starting point and to draw a (short) vector
with a given velocity. </p>
<p>As a vector is drawn by setting the direction and velocity,
the destination point is not defined by its absoulte coordinates.
Although the analog hardware is quite precise, 
the vector size is limited to a fraction of the sceen.
Thus, long vectors must be composed from shorter ones, 
as to restart at a known location.  </p>
<p>The board can handle two CRT's and lightguns.</p>
<p>The design was inspired by the Vectrex game console, 
but allows to set a starting point directly. </p>
<h1>Design</h1>
<p>The interface is essentially an settable integrator 
for X and Y deflection voltages.
The output of the board provides &plusmn;2.5V on its (analog) output.</p>
<p>Normal use is as follows:</p>
<ul>
<li>Transmit x and y coordinates of the starting point via SPI to the A/D converter</li>
<li>Strobe the <code>doMOVE</code> signal to set initial values of the integrators</li>
<li>Transmit x and y values for the speed via SPI</li>
<li>Strobe the <code>doDRAW</code> signal to draw the vector with the actually set speed</li>
</ul>
<p>The x and y coordinates are 12 bit values producing an output range 
of &plusmn;2.5V. Thus:</p>
<ul>
<li>2047 is 0V</li>
<li>0000 is -2.5V</li>
<li>4096 is +2.5V</li>
<li>1024 is -1.25V </li>
<li>3072 is +1.25V.</li>
</ul>
<p>The duration of the <code>doMOVE</code> signal must be at least 30&micro;s long to have the
initial value settled, due to the output resitance of the op amp of about 100Ω
to load the 10nF integration capacitor.</p>
<p>It must be inactive again before the draw signal is used.</p>
<p>While the <code>doDRAW</code> (and the <code>doMOVE</code>) signal is inactive, the integrators are halted,
i.e. do not change their current value for seconds. 
Once the <code>doDRAW</code> signal is active, the current x and y values
give the (relative) speed at which the coordinates are changed.
These are also 12-Bit values with the same encoding as above,
i.e. 2047 is zero, which means no change.
The values of 0 and 4095 mean full speed in decreasing and increasing
the coordinate voltages.</p>
<p>As the time constant of the integrators is 20kΩ*10nF=200&micro;s,
a 400&micro;s strobe with maximum speed input (0 or 4097) would be requied
to move from one border to the other one. 
Shorter vectors could be drawn either by decreasing the speed voltage
or strobe time.
As the controlling computer may not be able to produce short pulses
with e.g. 1&micro;s resolution or accuracy, 
the <code>MOVE</code> pulse is automatically truncated (internally) to 50&micro;s.
Thus, the maximum possible move is a difference of 0.25 in either direction
which is 12.5% of the screen width.
To draw a line from one border to the other, eight or more moves must be used. 
It is assumend that normally the controlling computer will generate 
a 60&micro;s pulse and set the speed to control the length of the vector
according to a 50&micro;s move.
Note that WWI could only draw vectors of half the length.</p>
<p>Although the interface would allow to chain moves without repositioning
the starting point, the time to set the starting point should be
invested.  </p>
<p>An intensification signal for the electron beam (z-axis) 
is automatically generated while the integration runs,
i.e. during the <code>doDRAW</code> signal, thus truncated to 50&micro;s.</p>
<h2>Single point display</h2>
<p>In order to show a single point, the starting point is moved to
and a vector of zero speed drawn.</p>
<h2>Calculating the speed amount</h2>
<p>For each dimension, the speed is calculated by the difference
of the end and start coordinate.</p>
<p>Using fixed point numbers for coordinates, the middle of the screen
is at (0.0, 0.0) and (-1.0, -1.0) is the lower left corner.</p>
<p>Thus, a maximum speed of -1.0 or +1.0 moves the point by 0.25.</p>
<p>In WWI, the vector length is given in upto 31 steps of 2<sup>-8</sup> units.
To move the point one unit, thus the speed must be 4<sup>-6</sup> per unit.
As the resolution is 11 bit (without sign), the vector length in the range of 0..31
is  multiplied by 64 (and added to 2048 finally). </p>
<h2>Vector intensities</h2>
<p>To draw vectors of uniform intensity, the effective speed in the
direction of the movement must be the same for all vectors.
Then, the length of the vector is determined by the duration 
of movement. </p>
<p>This may be one reason that the vectors in WWI are limited in length, 
so that long vectors &mdash; if ever required &mdash; are shown as a chain
of short ones of uniform intensity. </p>
<h2>Drawing circles</h2>
<p>Circles should be drawn as short vectors. 
A number of 60 vectors for a full screen circle is in general
visibly satisfying.
Multiplying the radius (in the range of 0.0 to 1.0) with 60.0
and truncating the result as integer number of points will speed up
small circles.
A minimum of 6 points is recommended. </p>
<h2>Character display</h2>
<p>Character display is currently done in software by drawing
those vectors that are intensified;
thus it takes upto 0.7ms  per character, as a single line uses 30&micro;s + 60&micro;s = 90&micro;s. </p>
<h2>Lightgun</h2>
<p>The lightgun uses a 3-pin connector with ground, +5V and a single input.</p>
<p>The sensor OPL801-OC can be connected without electronics;
the input has a pull-up of 4.7kΩ to 5V.</p>
<p>As the controlling computer might not be quick enough to catch a short pulse,
it sets a flipflop which is reset with each new position move.</p>
<p>In order to avoid false triggers if the lightgun is pointed outside
the screen, only the starting edge is used to set the flip-flop.
Continuous light still generates one signal when beginning,
but it is unlikely that the right time window will accidentially be used.</p>
<p>There is no electrical correlation of the lightgun with a specific screen.
Nevertheless is this no source of confusion, i.e. by giving a trigger
if the lighted dot is on a different screen. Of course, if the user of 
lightgun 2 normally used for screen 2 picks a dot on screen 1, this will
be valid and sensed. But as the flag is valid only until the next change
in coordinates, it will not be determined by screen 2 unless both show
the same dots, in which case it is what is expected.</p>
<h2>More CRTs</h2>
<p>To support two (or more) CRTs and lightguns,
the deflection circuits remain the same,
as the X and Y signals are common to all.</p>
<p>Two additional GPIO outputs enable the corresponding Z-Signals.
The polarity is selected for each on board.</p>
<p>One additional input is required for the second light pen. </p>
<h2>Mechanical and electrical hints</h2>
<p>The interface is a small board with the following connectors:</p>
<p>Output is a 8-pin connector for the X-, Y- and Z-signals plus
a ground pin for each for easier cable connection.
The signals are &plusmn;2.5V to ground.</p>
<p>Input is wired to 26-pin Raspberry double row pinning 
for simple connection to the latter;
to use an Arduino, a shield providing this connector is recommended.</p>
<p>The SPI interface must use the levels defined by VADC, which is normally
either 3.3V or 5.0V. The D/A-converter works from 2.7 to 5.5V,
as it has an internal referece of 2.048V. 
So it may be used with Raspberry Pi boards at 3.3V 
and also with older design that use 5V logical levels.</p>
<p>The +5V input is used as supply for the internal logic and as reference 
for the conversion to &plusmn;2.5V; 
the necessary negative supply is generated on board.</p>
<p>The two logic inputs may be any logic; &lt;2V for inactive
and >3V for active. </p>
<p>The GPIO Pins used are (besides SPI):</p>
<ul>
<li>17: Move to vector start position</li>
<li>22: Draw vector for 50&micro;s</li>
<li>23: Enable Z-strobe 1</li>
<li>24: Lightgun 1 input</li>
<li>25: Lightgun 2 input</li>
<li>18: Enable Z strobe 2</li>
<li>27: Keyswitch on board</li>
</ul>
<h1>Various</h1>
<h2>Z-inputs</h2>
<p>For some Oszilloscopes with Z-input (e.g. HM 512-2),
the signal is assumed to be short negative pulses
darkening a (small part) of the signal shown
as a time or event marker.
As the coupling is via capacitor to the high voltage,
a clamp diode is required to determine the default without pulses.
This diode is often such that negative pulses reduce the intensity,
so that normally the beam is visible.
To support positive pulses to show the beam, the diode
must be reversed. 
If a switch is used, check for sufficient voltage withstanding,
or use an appropriate relay. </p>
<h2>Split power</h2>
<p>The current design uses a D/A converter (MCP4821) that runs equally well
from 3.3V and 5.0V supplies, including logic, if 1.024&plusmn;1.024V are selected.</p>
<p>All logic in- and outputs use MOS-FETs (2N7000) that allow both voltage levels. </p>
<p>The analog section uses the output voltage range of the D/A converter,
i.e. 0V to 2.048V, with 1.024V as analog reference zero.
An output stage converts this to &plusmn;2.5V;
the required negative supply is provided on board.</p>
</body></html>
